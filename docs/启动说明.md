# 项目启动说明

> 文档版本：v1.3.0  
> 最后更新：2026-02-14

## 1. 环境要求
- Android Studio（最新稳定版）
- JDK 17（可直接使用 Android Studio 自带 JBR）
- Android SDK（项目默认路径或本机已配置路径）
- 真机或模拟器（Android 10+）

## 2. 打开项目
1. 打开 Android Studio
2. 选择 `Open`
3. 打开目录 `D:\Video Downloader`
4. 等待 Gradle Sync 完成

## 3. 终端构建（推荐）
```powershell
.\环境一键配置.ps1
.\gradlew.bat :app:assembleDebug
```

产物位置：`app/build/outputs/apk/debug/app-debug.apk`

## 4. 安装到设备
优先方式：
```powershell
.\gradlew.bat :app:installDebug
```

若本机 `adb` 不在 PATH，可直接执行：
```powershell
D:\Android\Sdk\platform-tools\adb.exe devices -l
D:\Android\Sdk\platform-tools\adb.exe install -r .\app\build\outputs\apk\debug\app-debug.apk
```

若出现 `INSTALL_FAILED_UPDATE_INCOMPATIBLE`（签名不一致）：
```powershell
D:\Android\Sdk\platform-tools\adb.exe uninstall com.example.videodownloader
D:\Android\Sdk\platform-tools\adb.exe install .\app\build\outputs\apk\debug\app-debug.apk
```

## 5. 最小验证流程
1. 首页粘贴抖音分享文案并解析，加入下载队列。
2. 用一条 `kstore.vip/*.html#...` 链接（如 `bluegay/xgaymv`）解析并下载。
3. 观察下载队列卡片：状态下方应显示进度条与百分比。
4. 下载完成后进入“历史/已完成”：
   - 点“管理”后应有“全选/取消全选”
   - 长按条目应直接进入管理并选中该条
5. 结果文件应可播放。

## 6. 常见提示
- 如果 Android Studio 一直下载 `gradle-*-src.zip`：这是源码包下载，不影响命令行构建与安装。
- 如果 X 解析失败：优先检查 Cookie 是否失效、代理是否可用。
- 如果 kstore 链接失败：优先检查 `auth_key` 是否过期。
- 若出现 `unsupported m3u8 key method`：说明链接使用了非 `AES-128` 加密方式。

## 7. 一键清理
```powershell
.\项目清理.ps1
```

## 变更记录
- 2026-02-10 v1.0.0：重构启动指引并对齐当时项目结构与常用命令
- 2026-02-10 v1.1.0：补充 m3u8 推荐/预览验证步骤
- 2026-02-14 v1.2.0：补充设备直装与签名冲突处理、m3u8 提速验证步骤
- 2026-02-14 v1.3.0：补充 kstore hash 链接与 AES-128 下载验证、已完成页交互验证
