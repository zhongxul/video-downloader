# 失败场景回归测试清单（当前实现对齐）

> 文档版本：v1.3.1  
> 最后更新：2026-02-14

## 1. 解析链路
### 1.1 抖音分享文案
- [ ] 粘贴整段抖音分享文案可提取真实链接。
- [ ] 文案含多段无关文本时，仍可命中链接。

### 1.2 X 普通视频
- [ ] Cookie 有效时可解析。
- [ ] Cookie 失效时有明确提示，不进入空白状态。
- [ ] `status` 链接解析耗时稳定（并行分支策略生效，无明显串行长等待）。
- [ ] 日志可看到分支耗时：`parseXFast`、`parseXStatusFast`、`parseTwitterFx mirror`。

### 1.3 kstore hash 链接（`*.html#...`）
- [ ] `bluegay.html#...` 可解析出真实 `m3u8/mp4` 地址。
- [ ] `xgaymv.html#...` 可解析出真实 `m3u8/mp4` 地址。
- [ ] 尾部存在额外 `#` 时仍可解析。

## 2. 下载链路
- [ ] 可下载项可正常入队。
- [ ] 失败任务可重试。
- [ ] 异常文件（空文件/文本内容）自动删除并归为失败。
- [ ] 下载队列卡片持续显示进度条与百分比。

## 3. m3u8 专项
### 3.1 普通 m3u8
- [ ] 分片下载过程中进度持续推进，无长时间停滞。
- [ ] 下载完成视频可正常播放，未出现顺序错乱。

### 3.2 加密 m3u8（AES-128）
- [ ] `#EXT-X-KEY:METHOD=AES-128` 链接可成功下载并播放。
- [ ] key 拉取失败时错误提示可读。
- [ ] IV 为空时可按分片序号生成默认 IV 并正常下载。
- [ ] 非 `AES-128`（如 `SAMPLE-AES`）返回明确不支持提示。

## 4. 历史管理
### 4.1 下载队列
- [ ] 管理模式支持全选/取消全选。
- [ ] 长按单项可进入管理模式并自动选中。
- [ ] 点击整行可选中，不依赖仅点复选框。

### 4.2 已完成页
- [ ] 点击“管理”后显示“全选/取消全选”按钮。
- [ ] 长按单项可进入管理模式并自动选中。
- [ ] 批量删除与分享行为正常。

## 5. 文件名与落盘
- [ ] 同标题重复下载不覆盖，自动生成 `(1)(2)...`。
- [ ] 下载完成文件可被系统媒体库识别。
- [ ] “已完成”只展示有效可播放结果。

## 6. 建议执行组合
- 抖音：2 条（短链/长链）
- X 普通视频：2 条（Cookie 有效/失效）
- kstore hash：2 条（`bluegay`/`xgaymv`）
- AES-128 m3u8：1 条（带 key）
- 非 AES-128 m3u8：1 条（用于不支持提示校验）

## 变更记录
- 2026-02-10 v1.0.0：按当时实现重排回归项，补充大小显示与错误文件治理校验点
- 2026-02-10 v1.1.0：新增推荐触发条件、m3u8 预览、同名重命名回归项
- 2026-02-14 v1.2.0：新增 m3u8 下载提速专项回归项
- 2026-02-14 v1.3.0：新增 kstore hash 解析、AES-128 下载、已完成页管理交互回归项
- 2026-02-14 v1.3.1：新增 X 解析提速与耗时日志回归项
